<#include "/WEB-INF/views/common/common.html"/>
<@layout>
<link rel="stylesheet" href="${ctx!}/res/ztree/css/zTreeStyle/zTreeStyle.css">
<script src="${ctx!}/res/ztree/js/jquery.ztree.all.min.js"></script>

</head>
<body>
<!-- 此处定义 body 部分 -->
<div id="master-layout">
    <div
            data-options="region:'north',border:false,bodyCls:'theme-header-layout'">
        <div class="theme-navigate">
            <!--  <div class="left">
                <a href="https://www.insdep.com/list-8-1.html" class="easyui-linkbutton" target="_blank">关于</a>
            </div> -->
            <div class="right">

                <a href="#" class="easyui-menubutton theme-navigate-user-button"
                   data-options="menu:'.theme-navigate-user-panel'">${(session.system_user.name)!}</a>
                <div class="theme-navigate-user-panel">
                    <dl>
                        <dd>
                            <img src="${ctx!}res/insdep/themes/insdep/images/portrait86x86.png" width="86" height="86">
                            <b class="badge-prompt">${(session.system_user.name)!}<i
                                    class="badge color-important">CTO</i></b>
                            <p>部门：${(session.system_user.orgName)!}</p>
                            <p>角色：${(session.system_user_roles)!} </p>
                        </dd>
                        <dt>
                            <a class="theme-navigate-user-modify">修改资料</a>
                            <a href="${ctx!}/logout" class="theme-navigate-user-logout">注销</a>
                        </dt>
                    </dl>
                </div>
            </div>
        </div>
    </div>
    <div data-options="region:'west',split:true,border:false" title="菜单"
         style="width: 200px; padding: 10px 20px;">
        <ul id="menuTree" class="ztree"></ul>
    </div>
    <div data-options="region:'center',border:false  ">
        <!-- 此处不能填写 fit=true 否则会造成datagrid 显示异常。datagrid 自身和外部第一个容器包含即可 -->
        <div id="tabsControl" class="   theme-tab-blue-line  "
             style="background: #fff;  "></div>
    </div>
</div>
<script>
    (function () {
        $.getJSON("${ctx!}/treeMenu", function (d) {

            // 取消url 默认属性，菜单实体不用url变量名更好
            for(var i =0;i<d.length;i++){
                d[i]._url = d[i].url;
                d[i].url = "javascript:void(0);";
            }

            // 叶子 点击 回调事件
            var callbackObj = {};
            callbackObj.onClick = function(event, treeId, treeNode, clickFlag){
                if(!treeNode.isParent){
                    $.insdep.tabControl("${ctx!}" + treeNode._url,
                        "", treeNode.name);
                };
            }

            // 构造树木
            permissMenuTree($("#menuTree"),d,false,callbackObj);

        })
    })();
</script>
</@layout>